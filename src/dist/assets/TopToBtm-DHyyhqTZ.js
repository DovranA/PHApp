import{r,j as f}from"./index-BPfmdpj5.js";import{u as I,f as O,M as T,a as $,P as b,L as U,m as B}from"./motion-D6_1TIaT.js";function F(){const t=r.useRef(!1);return I(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function N(){const t=F(),[s,e]=r.useState(0),n=r.useCallback(()=>{t.current&&e(s+1)},[s]);return[r.useCallback(()=>O.postRender(n),[n]),s]}class H extends r.Component{getSnapshotBeforeUpdate(s){const e=this.props.childRef.current;if(e&&s.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function S({children:t,isPresent:s}){const e=r.useId(),n=r.useRef(null),l=r.useRef({width:0,height:0,top:0,left:0}),{nonce:p}=r.useContext(T);return r.useInsertionEffect(()=>{const{width:d,height:u,top:x,left:h}=l.current;if(s||!n.current||!d||!u)return;n.current.dataset.motionPopId=e;const o=document.createElement("style");return p&&(o.nonce=p),document.head.appendChild(o),o.sheet&&o.sheet.insertRule(`
          [data-motion-pop-id="${e}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            top: ${x}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(o)}},[s]),f.jsx(H,{isPresent:s,childRef:n,sizeRef:l,children:r.cloneElement(t,{ref:n})})}const w=({children:t,initial:s,isPresent:e,onExitComplete:n,custom:l,presenceAffectsLayout:p,mode:d})=>{const u=$(A),x=r.useId(),h=r.useMemo(()=>({id:x,initial:s,isPresent:e,custom:l,onExitComplete:o=>{u.set(o,!0);for(const c of u.values())if(!c)return;n&&n()},register:o=>(u.set(o,!1),()=>u.delete(o))}),p?[Math.random()]:[e]);return r.useMemo(()=>{u.forEach((o,c)=>u.set(c,!1))},[e]),r.useEffect(()=>{!e&&!u.size&&n&&n()},[e]),d==="popLayout"&&(t=f.jsx(S,{isPresent:e,children:t})),f.jsx(b.Provider,{value:h,children:t})};function A(){return new Map}function D(t){return r.useEffect(()=>()=>t(),[])}const m=t=>t.key||"";function G(t,s){t.forEach(e=>{const n=m(e);s.set(n,e)})}function V(t){const s=[];return r.Children.forEach(t,e=>{r.isValidElement(e)&&s.push(e)}),s}const W=({children:t,custom:s,initial:e=!0,onExitComplete:n,exitBeforeEnter:l,presenceAffectsLayout:p=!0,mode:d="sync"})=>{const u=r.useContext(U).forceRender||N()[0],x=F(),h=V(t);let o=h;const c=r.useRef(new Map).current,E=r.useRef(o),C=r.useRef(new Map).current,y=r.useRef(!0);if(I(()=>{y.current=!1,G(h,C),E.current=o}),D(()=>{y.current=!0,C.clear(),c.clear()}),y.current)return f.jsx(f.Fragment,{children:o.map(i=>f.jsx(w,{isPresent:!0,initial:e?void 0:!1,presenceAffectsLayout:p,mode:d,children:i},m(i)))});o=[...o];const M=E.current.map(m),j=h.map(m),L=M.length;for(let i=0;i<L;i++){const a=M[i];j.indexOf(a)===-1&&!c.has(a)&&c.set(a,void 0)}return d==="wait"&&c.size&&(o=[]),c.forEach((i,a)=>{if(j.indexOf(a)!==-1)return;const v=C.get(a);if(!v)return;const k=M.indexOf(a);let g=i;if(!g){const K=()=>{c.delete(a);const P=Array.from(C.keys()).filter(R=>!j.includes(R));if(P.forEach(R=>C.delete(R)),E.current=h.filter(R=>{const z=m(R);return z===a||P.includes(z)}),!c.size){if(x.current===!1)return;u(),n&&n()}};g=f.jsx(w,{isPresent:!1,onExitComplete:K,custom:s,presenceAffectsLayout:p,mode:d,children:v},m(v)),c.set(a,g)}o.splice(k,0,g)}),o=o.map(i=>{const a=i.key;return c.has(a)?i:f.jsx(w,{isPresent:!0,presenceAffectsLayout:p,mode:d,children:i},m(i))}),f.jsx(f.Fragment,{children:c.size?o:o.map(i=>r.cloneElement(i))})},_=t=>{const s=r.useRef(null);return r.useEffect(()=>{const e=n=>{s.current&&!s.current.contains(n.target)&&t()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[t]),s},Q=({open:t,style:s,children:e,setClose:n})=>{const l=_(()=>{n(!1)});return f.jsx(W,{children:t&&f.jsx(B.div,{ref:l,initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:s,children:e})})};export{W as A,Q as T,_ as u};
