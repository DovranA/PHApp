import{u as b,r as i,j as r,T as j,d as E,U as I,V as T,W as C,o as L}from"./index-BPfmdpj5.js";import{S as A}from"./Sidebar-CrBnEOXb.js";import{B as _,L as D,R as F,s as B,a as O}from"./style-3WSbhIfl.js";import{L as z}from"./index-nw_7Qdlw.js";import{b as M}from"./index-CmJFHjED.js";import{S as H,P as K,a as U}from"./swiper-DiBAr92Y.js";import{A as q}from"./autoplay-DOEdHaJN.js";import{m as P}from"./motion-D6_1TIaT.js";import"./index-BwMECd8K.js";import"./index-CZFE0WBW.js";import"./TopToBtm-DHyyhqTZ.js";import"./index-C_UYdc-g.js";const W="_loadingDiv_95p9h_1",G="_ldsring_95p9h_8",R={loadingDiv:W,ldsring:G,"lds-ring":"_lds-ring_95p9h_1"},J=({content:t,options:e})=>{const v=b(),s=i.useRef(null),[l,x]=i.useState(t.id==e.playingVideo),[m,n]=i.useState(0),[o,u]=i.useState(0),d=()=>{s.current&&u(s.current.duration)},p=a=>{s.current&&(s.current.currentTime=parseFloat(a.target.value))};return i.useEffect(()=>{const a=setInterval(()=>{s.current&&n(s.current.currentTime)},1e3);return()=>clearInterval(a)},[]),i.useEffect(()=>{const a=s.current,f=new IntersectionObserver(h=>{h.forEach(g=>{var w,S;if(s.current&&(g.intersectionRatio>=.5?(s.current.src=(w=s.current)!=null&&w.dataset.src?(S=s.current)==null?void 0:S.dataset.src:"#",x(e.play),localStorage.setItem("share",t.share_token),e.setPlayingVideo(g.target.id)):s.current.src="null"),!g.isIntersecting){x(!1);return}})},{threshold:.5});return a&&f.observe(a),()=>{a&&f.unobserve(a)}},[e.playingVideo]),i.useEffect(()=>{var a,f,h;if(((a=s.current)==null?void 0:a.src.split("/")[3])!=="null"&&s.current&&(e.spin===-1&&(s.current.currentTime-=3,e.setSpin(0)),e.spin===1&&(s.current.currentTime+=3,e.setSpin(0))),e.play&&e.playingVideo===String(t.id)){(f=s.current)==null||f.play();return}(h=s.current)==null||h.pause()},[e.play,e.spin]),r.jsxs(r.Fragment,{children:[r.jsx("video",{className:"w-full h-full object-cover",id:String(t.id),autoPlay:l,"data-src":t.medias[0],ref:s,loop:!0,preload:"metadata",onClick:()=>{x(!l),e.setPlay(!e.play)},muted:e.mute,onDoubleClick:()=>v(j(!t.liked)),poster:t.thumbnail,onLoadedMetadata:d}),r.jsx(_,{image:t.avatar,title:t.username,desc:t.description,currentTime:m,duration:o,onSeek:p,date:t.posted_at})]})},Q=({content:t,options:e})=>(console.log(t),r.jsxs("div",{className:" h-[95dvh] snap-start  flex",children:[r.jsx("div",{className:"  relative  rounded-2xl overflow-hidden",style:{width:e.width},children:r.jsx(J,{content:t,options:e})}),r.jsx(D,{downCount:t.download_count,likeCount:t.like_count,shareCount:t.share_count,id:t.id,liked:t.liked})]})),X=({content:t,options:e})=>{const v=b(),s=i.useRef(null),l=i.useRef(null),[x,m]=i.useState(t.id==e.playingVideo);return i.useEffect(()=>{const n=l.current,o=new IntersectionObserver(u=>{u.forEach(d=>{var p,a,f,h;if(s.current&&(d.intersectionRatio>=.5?(s.current.src=((p=s.current)==null?void 0:p.dataset.src)||"#",m(e.play),localStorage.setItem("share",t.share_token),e.setPlayingVideo(d.target.id),(a=l.current)==null||a.swiper.slideToLoop(0),(f=l.current)==null||f.swiper.autoplay.resume()):(s.current.src="null",(h=l.current)==null||h.swiper.autoplay.pause()),!d.isIntersecting)){m(!1);return}})},{threshold:.5});return n&&o.observe(l.current),()=>{n&&o.unobserve(n)}},[e.playingVideo]),i.useEffect(()=>{var n,o,u,d,p,a;if(e.spin===-1?((n=l.current)==null||n.swiper.slidePrev(),e.setSpin(0)):e.spin===1&&((o=l.current)==null||o.swiper.slideNext(),e.setSpin(0)),e.play&&e.playingVideo===String(t.id)){(u=s.current)==null||u.play(),(d=l.current)==null||d.swiper.autoplay.resume();return}else(p=l.current)==null||p.swiper.autoplay.pause(),(a=s.current)==null||a.pause()},[e.play,e.spin]),r.jsxs(r.Fragment,{children:[r.jsx(H,{id:String(t.id),ref:l,spaceBetween:20,loop:!0,modules:[K,q],autoplay:{delay:3e3,disableOnInteraction:!1},pagination:{clickable:!0},onClick:()=>{var n,o,u;m(!x),e.setPlay(!e.play),(n=l.current)!=null&&n.swiper.autoplay.paused?(o=l.current)==null||o.swiper.autoplay.resume():(u=l.current)==null||u.swiper.autoplay.pause()},onDoubleClick:()=>v(j(!t.liked)),children:t.medias.map((n,o)=>r.jsx(U,{children:r.jsx("img",{className:"w-full object-cover object-center",src:n,alt:""})},o))}),r.jsx("audio",{className:"w-full h-full object-cover",id:String(t.id),autoPlay:x,"data-src":t.audios.audio,ref:s,loop:!0,preload:"metadata",muted:e.mute}),r.jsx(_,{image:t.avatar,title:t.username,desc:t.description,date:t.posted_at})]})},Y=({content:t,options:e})=>r.jsxs("div",{className:"h-[95dvh] snap-start flex",children:[r.jsx("div",{className:"relative rounded-2xl overflow-hidden post",style:{width:e.width},children:r.jsx(X,{content:t,options:e})}),r.jsx(D,{downCount:t.download_count,likeCount:t.like_count,shareCount:t.share_count,id:t.id,liked:t.liked,audio:t.audios,isPlay:e.play})]}),Z=()=>{const t=b(),e=i.useRef(null),{id:v,startfrom:s,limit:l,qr:x,titleVideo:m,type:n}=E(d=>d.player);i.useEffect(()=>{console.log("object");const d=e.current,p=new IntersectionObserver(a=>{a.forEach(f=>{f.intersectionRatio>=.2&&t(I({id:v,titleVideo:m,limit:l,qr:x,startfrom:s,type:n}))})},{threshold:.2});return d&&p.observe(d),()=>{d&&p.unobserve(d)}},[s]);const u=window.innerHeight/16*9;return r.jsx("div",{style:{width:u},className:" h-[95dvh] snap-start  flex",children:r.jsx("div",{className:"w-[470px]  relative  rounded-2xl overflow-hidden",children:r.jsx("div",{ref:e,className:R.loadingDiv,children:r.jsxs("div",{className:R.ldsring,children:[r.jsx("div",{}),r.jsx("div",{}),r.jsx("div",{}),r.jsx("div",{})]})})})})},$=()=>{const t=b(),{data:e,idx:v,likeVis:s,firstvideo:l,topplayerType:x}=E(c=>c.player),m=i.useRef(null),[n,o]=i.useState(!0),[u,d]=i.useState(!1),[p,a]=i.useState(0),[f,h]=i.useState(null),[g,w]=i.useState(!1);i.useEffect(()=>{w(!0);const c=setTimeout(()=>{w(!1)},500);return()=>clearTimeout(c)},[n]),i.useEffect(()=>{const c=y=>{switch(y.code){case"Space":y.preventDefault(),o(N=>!N);break;case"ArrowLeft":y.preventDefault(),a(-1);break;case"ArrowRight":y.preventDefault(),a(1);break;case"ArrowUp":y.preventDefault(),O(m.current);break;case"ArrowDown":y.preventDefault(),B(!1,m.current);break;case"KeyM":y.preventDefault(),d(N=>!N);break;case"KeyL":y.preventDefault(),t(j(!0));break}},V=document.getElementById(String(v));return V&&V.scrollIntoView({behavior:"instant"}),document.addEventListener("keydown",c),h(e!=null&&e.length?e[0].id:null),()=>{t(T()),document.removeEventListener("keydown",c),t(C("default"))}},[]),i.useEffect(()=>{const c=setTimeout(()=>{t(j(!1))},400);return()=>clearTimeout(c)},[s]),i.useEffect(()=>{const c=document.getElementById(String(l));c&&c.scrollIntoView()},[l]);const k=window.innerHeight/16*9;return r.jsxs("div",{className:"flex pt-1  relative ",children:[r.jsx(F,{scroolRef:m}),r.jsxs("div",{id:"videoDivForScrool",ref:m,className:" grid  gap-5 items-center overflow-x-hidden overflow-y-auto flex-col flex-nowrap min-h-fit snap-y snap-mandatory scroll-smooth pb-[5dvh] ",children:[e.map(c=>c.type==="video"?r.jsx(Q,{options:{playingVideo:f,setPlayingVideo:h,play:n,setPlay:o,mute:u,spin:p,setSpin:a,width:k},content:c},c.id):r.jsx(Y,{options:{playingVideo:f,setPlayingVideo:h,play:n,setPlay:o,mute:u,spin:p,setSpin:a,width:k},content:c},c.id)),r.jsx(Z,{}),";"]}),s&&r.jsx(P.div,{initial:{opacity:0},className:"absolute z-40 h-[10rem] w-[10rem]  top-[calc(50%-5rem)]  flex justify-center items-center left-[calc(50%-5rem)] transform -translate-x-1/2 -translate-y-1/2",animate:{opacity:1,y:0,scale:2},exit:{opacity:0},transition:{duration:.4,y:100},children:r.jsx(z,{fill:"red",color:"red",className:"text-9xl"})}),g&&!s&&r.jsx(P.div,{initial:{opacity:0},className:"absolute w-[4rem] h-[4rem]  z-30 top-[calc(50%-2rem)]  flex justify-center items-center left-[calc(50%-2rem)] transform -translate-x-1/2 -translate-y-1/2",animate:{opacity:.8,y:0},exit:{opacity:0},transition:{duration:.4,y:100},children:n?r.jsx(L,{color:"white",size:50}):r.jsx(M,{color:"white",size:50})}),r.jsx("div",{className:"absolute z-20 w-full  top-5 flex justify-center",children:x==="choosen"?r.jsxs("div",{style:{width:k},className:" flex relative justify-center items-center",children:[r.jsx("h2",{className:"border-b-2 border-white text-white text-xl font-bold",children:"Choosens"}),r.jsxs("span",{className:"absolute right-3 text-white text-lg font-bold",children:[e.findIndex(c=>c.id==f)+1,"/",e.length]})]}):r.jsxs("div",{className:"w-[27.2%] flex relative justify-center items-center gap-6",children:[r.jsx("h2",{className:"border-b-2 border-white text-white text-xl font-bold",children:"Follower"}),r.jsx("h2",{className:" text-white text-xl font-bold",children:"For you"})]})})]})},fe=()=>r.jsxs("div",{className:"flex bg-primary h-screen w-full overflow-hidden",children:[r.jsx(A,{}),r.jsx("div",{className:"h-screen flex flex-[10]  justify-center bg-black  relative",children:r.jsx($,{})})]});export{fe as default};
